# 記法システム比較表

mj-tilesで採用する記法システムと現行仕様の比較表です。

## 表現可能な要素の比較

| 表現要素 | 現行仕様 | 新篠ゆう方式 | 牌画作成くん方式 | 備考 |
|---------|---------|------------|----------------|------|
| **基本牌** | | | | |
| 数牌（萬子） | ✅ `123m` | ✅ `123m` | ✅ `123m` | 全システム共通 |
| 数牌（筒子） | ✅ `456p` | ✅ `456p` | ✅ `456p` | 全システム共通 |
| 数牌（索子） | ✅ `789s` | ✅ `789s` | ✅ `789s` | 全システム共通 |
| 字牌（漢字） | ✅ `東南西北白發中` | ✅ `東南西北白發中` | ❌ | 牌画作成くんは独自記号 |
| 字牌（z形式） | ✅ `1234567z` | ✅ `1234567z` | ❌ | 牌画作成くんは独自記号 |
| 字牌（独自） | ❌ | ❌ | ✅ `tnsprhc` | t=東, n=南, s=西, p=北, h=白, r=發, c=中 |
| **赤ドラ** | | | | |
| 0形式 | ✅ `0m`, `0p`, `0s` | ✅ `0m`, `0p`, `0s` | ❌ | 牌画作成くんはa修飾子 |
| r5形式 | ✅ `r5m`, `r5p`, `r5s` | ✅ `r5m`, `r5p`, `r5s` | ❌ | 牌画作成くんはa修飾子 |
| a修飾子 | ❌ | ❌ | ✅ `a5m`, `a5p`, `a5s` | 前置修飾子 |
| **副露（チー）** | | | | |
| 上家からチー | ❌ | ✅ `2-13m` | ✅ `y2 1 3m` | 記号位置で判定 vs y修飾子 |
| 対面からチー | ❌ | ✅ `12-3m` | ✅ `1 y2 3m` | 同上 |
| 下家からチー | ❌ | ✅ `123-m` | ✅ `1 2 y3m` | 同上 |
| **副露（ポン）** | | | | |
| 上家からポン | ❌ | ✅ `5-55p` | ✅ `y5 5 5p` | 同上 |
| 対面からポン | ❌ | ✅ `55-5p` | ✅ `5 y5 5p` | 同上 |
| 下家からポン | ❌ | ✅ `555-p` | ✅ `5 5 y5p` | 同上 |
| **副露（カン）** | | | | |
| 大明槓（上家） | ❌ | ✅ `4-444s` | ✅ `y4 4 4 4s` | 同上 |
| 大明槓（対面） | ❌ | ✅ `44-44s` | ✅ `4 y4 4 4s` | 同上 |
| 大明槓（下家） | ❌ | ✅ `444-4s` | ✅ `4 4 4 y4s` | 同上 |
| 加槓 | ❌ | ✅ `5-55=0p` | ✅ `5y55a5p` | =記号 vs 横向き位置保持 |
| 暗槓 | ❌ | ✅ `1111+z` | ✅ `o 3 3s o` | +記号 vs o修飾子 |
| **特殊状態** | | | | |
| 横向き（立直牌） | ❌ | ❌ | ✅ `y5p` | 捨て牌での立直宣言 |
| ツモ牌 | ❌ | ✅ 最後に種類記号 | ✅ `5pm` | `3456s3s` vs 後置m |
| ロン牌 | ❌ | ✅ 最後に種類記号 | ✅ `5pl` | 同上 vs 後置l |
| ツモ切り | ❌ | ❌ | ✅ `g5p` | 前置g修飾子 |
| 伏せ牌 | ❌ | ❌ | ✅ `o` | 裏面表示 |
| ドラ表示 | ❌ | ❌ | ✅ `5pd` | 後置d修飾子 |
| **複合表現** | | | | |
| 赤ドラツモ切り立直 | ❌ | ❌ | ✅ `gya5p` | 複数修飾子の組み合わせ |
| 捨て牌列（河） | ❌ | ❌ | ✅ `j...` | j行頭マーカー |
| 空白・区切り | ❌ | ❌ | ✅ 半角スペース | 明示的な区切り |

## 記法の特徴比較

### 現行仕様（mj-tiles v1.x）

**対応範囲:**
- 基本的な手牌の表示
- 数牌・字牌の標準記法
- 赤ドラ（2種類の記法）

**特徴:**
- ✅ シンプルで学習コストが低い
- ✅ 基本的な麻雀表現に特化
- ✅ パーサーが軽量
- ❌ 副露・特殊状態の表現不可

**使用例:**
```
123m456p789s東南西北  // 基本的な手牌
19m19p19s1234567z     // 国士無双
1230m456p789s         // 赤ドラ入り
```

### 新篠ゆう方式（MPSZ拡張表記案）

**対応範囲:**
- 現行仕様の全機能
- 副露（チー・ポン・カン）の完全な表現
- 鳴きの方向性（上家・対面・下家）
- 加槓・暗槓の区別

**特徴:**
- ✅ 副露情報が詳細
- ✅ MPSZ標準形式の自然な拡張
- ✅ 方向性情報を記号位置で表現（直感的）
- ✅ プログラム実装しやすい（kobalab準拠）
- ❌ ツモ切りや立直宣言牌などの表現は弱い

**使用例:**
```
2-13m           // 二萬をチー（上家から）
55-5p           // 五筒をポン（対面から）
444-4s          // 四索を大明槓（下家から）
55=50p          // 五筒を加槓
1111+z          // 東を暗槓
3456s3s         // 三四五六索で三索をツモ
```

### 牌画作成くん方式

**対応範囲:**
- 数牌の基本表記
- 修飾子による豊富な状態表現
- 横向き牌（副露・立直）
- ツモ・ロン・ドラの区別
- ツモ切り・伏せ牌
- 捨て牌列（河）の表現

**特徴:**
- ✅ 視覚的な状態を細かく表現
- ✅ 修飾子の組み合わせで柔軟な表現
- ✅ 捨て牌やツモ切りなど実戦的な情報
- ✅ 加槓も表現可能（横向き位置を保持）
- ❌ 字牌の記号が独自（tnsprhc）
- ⚠️ 副露の方向性情報は横向き位置から推測（3枚=ポン、4枚=カン）
- ❌ パース処理が複雑

**使用例:**
```
gya5p           // 赤5pをツモ切りで立直
88py88p         // 8pで大明槓
o33so           // 3sの暗槓（伏せ牌表示）
78y9p           // 七八九筒をチー
5y55p           // 五筒をポン（1枚目を上家から）
55y5p           // 五筒をポン（2枚目を対面から）
555yp           // 五筒をポン（3枚目を下家から）
55y55p          // 五筒を加槓（元々2枚目が横向き=対面からポン後に加槓）
5pm             // 5pをツモ
5pl             // 5pでロン
jpt1ss9p...     // 捨て牌列（河）
```

## 加槓表現の詳細比較

### 新篠ゆう方式：`=` 記号で明示

```
55-5p     → 五筒をポン（対面から）
55-5=5p   → 加槓後（五筒を追加）
```

- **メリット**: 加槓を明示的に表現、元のポン情報も保持
- **特徴**: `-` で元の鳴き、`=` で追加牌を区別
- **記法ルール**:
  - `-` の位置: 元のポンでどこから鳴いたか
  - `=` の位置: 加槓で追加した牌（常に最後の数字）

### 牌画作成くん方式：横向き位置を保持

```
55y5p    → 五筒をポン（2枚目が横向き = 対面から）
55y55p   → 加槓後（横向き位置を保持）
```

- **メリット**: 視覚的にわかりやすい（横向き牌の位置が変わらない）
- **特徴**: 3枚→4枚の変化で加槓を表現

### 実際の使用例

#### 対面から5筒をポン → 赤5筒で加槓

**新篠ゆう方式:**
```
55-5p     → ポン（対面から）
55-5=0p   → 加槓（赤五筒を追加）
```

**牌画作成くん方式:**
```
55y5p     → ポン（対面から）
55y5a5p   → 加槓（赤ドラ使用）
```

#### 上家から東をポン → 加槓

**新篠ゆう方式:**
```
1-11z     → ポン（上家から）
1-11=1z   → 加槓（東を追加）
```

**牌画作成くん方式:**
```
ty t tp   → ポン（独自字牌記号）
ty t t tp → 加槓
```

## 統合方針の提案

### ハイブリッドアプローチ

両システムの長所を組み合わせて実装することを推奨します：

#### Phase 1: 基本拡張（新篠ゆう方式ベース）
```typescript
// 副露の完全な表現
"123m 2-13p 55-5s"  // 手牌 + チー + ポン
```

#### Phase 2: 状態修飾子（牌画作成くん方式から選択的に採用）
```typescript
// y: 横向き（副露・立直）
// a: 赤ドラ（0m記法の代替として）
// m/l: ツモ/ロン牌
"123m 2-13p 5pm"    // ツモ牌の明示
"123m ya5p"         // 赤5pで立直
```

#### Phase 3: 高度な表現（オプション）
```typescript
// g: ツモ切り
// o: 伏せ牌
// d: ドラ
// j: 捨て牌列
```

### 優先順位マトリクス

| 機能 | 優先度 | 採用方式 | 理由 |
|------|--------|---------|------|
| チー・ポン・カンの基本 | 🔴 高 | 新篠ゆう | 副露は麻雀の基本機能 |
| 鳴きの方向性 | 🔴 高 | 新篠ゆう | 実戦で重要な情報 |
| 加槓・暗槓の区別 | 🟡 中 | 新篠ゆう | 点数計算に影響 |
| 横向き表示 | 🟡 中 | 牌画作成くん | 視覚的にわかりやすい |
| ツモ/ロン牌の明示 | 🟡 中 | 牌画作成くん | 和了形式の区別 |
| 赤ドラ修飾子 | 🟢 低 | 牌画作成くん | 既存の0m記法で代用可能 |
| ツモ切り | 🟢 低 | 牌画作成くん | 教育・解説用途 |
| 伏せ牌 | 🟢 低 | 牌画作成くん | 暗槓の視覚表現 |
| 捨て牌列 | 🟢 低 | 牌画作成くん | 別コンポーネント化推奨 |

## 実装例：ハイブリッド記法

### 基本的な副露

```typescript
// 現行
<Tiles hand="123m456p789s" />

// 拡張後
<Tiles hand="123m 2-13p 55-5s" />  // チー + ポン
<Tiles hand="12m 444-4s 666=z" />  // 大明槓 + 加槓
<Tiles hand="12m 1111+z 55s" />    // 暗槓
```

### 状態修飾子との組み合わせ

```typescript
// ツモ牌の明示
<Tiles hand="123m456p 7sm" />      // 7sをツモ

// ロン牌の明示
<Tiles hand="123m456p 7sl" />      // 7sでロン

// 赤ドラと副露
<Tiles hand="a5m 2-13p 55s" />     // 赤5m + チー
<Tiles hand="0m 2-13p 55s" />      // 同上（0m記法）
```

### 複雑な手牌

```typescript
// 立直・ツモ・副露の組み合わせ
<Tiles hand="123s y6p 78-9m 7sm" />
// 一二三索 + 立直宣言の六筒 + チー + ツモ牌

// 複数の副露
<Tiles hand="11m 2-13p 55-5s 777+z" />
// 一一萬 + チー + ポン + 暗槓
```

## 互換性の確保

### 後方互換性

現行の記法は引き続き動作するよう保証します：

```typescript
// これらは全て引き続き動作
<Tiles hand="123m456p789s" />
<Tiles hand="東南西北白發中" />
<Tiles hand="1234567z" />
<Tiles hand="0m0p0s" />
<Tiles hand="r5mr5pr5s" />
```

### 段階的な移行

1. **v2.0**: 新篠ゆう方式の副露対応（`-`, `=`, `+`）
2. **v2.1**: 牌画作成くん方式の基本修飾子（`y`, `m`, `l`）
3. **v2.2**: 高度な修飾子（`a`, `g`, `o`, `d`, `j`）

各バージョンで後方互換性を維持します。

## 参考資料

- [MPSZ拡張表記案 - 新篠ゆう](https://note.com/yuarasino/n/n1ba95bf3b618)
- [牌画作成くん byその研](https://mahjong-manage.com/paiga/paiga1.php)
- [kobalab/majiang-core Wiki](https://github.com/kobalab/majiang-core/wiki)
- [現行 mj-tiles README](../../README.md)
